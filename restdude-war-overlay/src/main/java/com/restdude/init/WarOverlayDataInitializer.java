/**
 *
 * Restdude
 * -------------------------------------------------------------------
 *
 * Copyright Â© 2005 Manos Batsis (manosbatsis gmail)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */
package com.restdude.init;

import com.restdude.mdd.model.ErrorModel;
import com.restdude.domain.error.model.ErrorLog;
import com.restdude.domain.error.model.SystemError;
import com.restdude.domain.error.service.ErrorLogService;
import com.restdude.domain.error.service.SystemErrorService;
import com.restdude.domain.users.model.User;
import com.restdude.util.ConfigurationFactory;
import org.apache.commons.configuration.Configuration;
import org.apache.commons.lang.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

import javax.annotation.PostConstruct;
import javax.inject.Named;
import java.time.LocalDateTime;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.List;


/**
 * {@inheritDoc}
 */
@Component
@Named(WarOverlayDataInitializer.BEAN_NAME)
public class WarOverlayDataInitializer extends DataInitializer {

    private static final Logger LOGGER = LoggerFactory.getLogger(WarOverlayDataInitializer.class);
    public static final String BEAN_NAME = "calipsoDataInitializer";

    protected SystemErrorService systemErrorService;
    protected ErrorLogService stackTraceService;

    @Autowired
    public void setSystemErrorService(SystemErrorService systemErrorService) {
        this.systemErrorService = systemErrorService;
    }

    @Autowired
    public void setStackTraceService(ErrorLogService stackTraceService) {
        this.stackTraceService = stackTraceService;
    }

    @Override
    protected String getTestEmailDomain() {
        Configuration config = ConfigurationFactory.getConfiguration();
        return config.getString("restdude.testEmailDomain");
    }

    @PostConstruct
    @Transactional(readOnly = false)
    public void run() {

        super.run();
        ;

        Configuration config = ConfigurationFactory.getConfiguration();
        boolean initData = config.getBoolean(ConfigurationFactory.INIT_DATA, true);

        if (initData && this.systemErrorService.count() == 0) {

            initSystemErrors(this.userService.findAll());

        } else {

            LOGGER.debug("run, skipping data init");
        }


        // send test email?
        if (config.getBoolean(ConfigurationFactory.TEST_EMAIL_ENABLE, false)) {
            String testEmailUsername = config.getString(ConfigurationFactory.TEST_EMAIL_USER, "system");
            if (StringUtils.isNotBlank(testEmailUsername)) {
                User u = this.userService.findOneByUserNameOrEmail(testEmailUsername);
                this.emailService.sendTest(u);
            }
        }


    }


    protected List<ErrorModel> initSystemErrors(Iterable<User> users) {
        List<ErrorModel> errors = new LinkedList<ErrorModel>();
        Iterator<User> usersIterator = users.iterator();
        User user = null;
        Object[][] stackTraces = {
                {"FED4F6BD528E72CEFAD4F16B26C8892B", "2016-11-27 08:58:30.11", "BeanValidationException: Validation failed", "com.restdude.util.exception.http.BeanValidationException: Validation failed\n	at com.restdude.mdd.service.AbstractBaseServiceImpl.validate(AbstractBaseServiceImpl.java:329)\n	at com.restdude.mdd.service.AbstractBaseServiceImpl.create(AbstractBaseServiceImpl.java:85)\n	at com.restdude.domain.users.service.impl.UserServiceImpl.create(UserServiceImpl.java:132)\n	at com.restdude.domain.users.service.impl.UserServiceImpl.create(UserServiceImpl.java:54)\n	at sun.reflect.GeneratedMethodAccessor143.invoke(Unknown Source)\n	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n	at java.lang.reflect.Method.invoke(Method.java:498)\n	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:333)\n	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)\n	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)\n	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99)\n	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:281)\n	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96)\n	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)\n	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:213)\n	at com.sun.proxy.$Proxy180.create(Unknown Source)\n	at com.restdude.auth.userAccount.controller.UserAccountController.create(UserAccountController.java:105)\n	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n	at java.lang.reflect.Method.invoke(Method.java:498)\n	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:221)\n	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:136)\n	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:114)\n	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:827)\n	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:738)\n	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:85)\n	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:963)\n	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:897)\n	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:970)\n	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:872)\n	at javax.servlet.http.HttpServlet.service(HttpServlet.java:707)\n	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:846)\n	at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)\n	at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:838)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1550)\n	at com.restdude.web.filters.RestRequestNormalizerFilter.doFilterInternal(RestRequestNormalizerFilter.java:94)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.tuckey.web.filters.urlrewrite.RuleChain.handleRewrite(RuleChain.java:176)\n	at org.tuckey.web.filters.urlrewrite.RuleChain.doRules(RuleChain.java:145)\n	at org.tuckey.web.filters.urlrewrite.UrlRewriter.processRequest(UrlRewriter.java:92)\n	at org.tuckey.web.filters.urlrewrite.UrlRewriteFilter.doFilter(UrlRewriteFilter.java:394)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:197)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1529)\n	at org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:225)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:550)\n	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n	at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\n	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1589)\n	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1213)\n	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:487)\n	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1552)\n	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1126)\n	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n	at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\n	at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:118)\n	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)\n	at org.eclipse.jetty.server.Server.handle(Server.java:550)\n	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:321)\n	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:254)\n	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:269)\n	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:97)\n	at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:124)\n	at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:102)\n	at org.eclipse.jetty.util.thread.strategy.ExecutingExecutionStrategy.invoke(ExecutingExecutionStrategy.java:58)\n	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:201)\n	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:133)\n	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:672)\n	at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:590)\n	at java.lang.Thread.run(Thread.java:745)",
                        new SystemError.Builder().message("Validation failed").httpStatusCode(400).requestMethod("POST").requestUrl("/api/auth/account").build()},
                {"5E7FE914483854E95273AB4D072A5D47", "2016-11-27 08:58:30.58", "InvalidCredentialsException: Invalid credentials", "com.restdude.util.exception.http.InvalidCredentialsException: Invalid credentials\n	at com.restdude.auth.userdetails.service.impl.UserDetailsServiceImpl.create(UserDetailsServiceImpl.java:137)\n	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n	at java.lang.reflect.Method.invoke(Method.java:498)\n	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:333)\n	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)\n	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)\n	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99)\n	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:281)\n	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96)\n	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)\n	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:213)\n	at com.sun.proxy.$Proxy183.create(Unknown Source)\n	at com.restdude.auth.userdetails.controller.UserDetailsController.create(UserDetailsController.java:77)\n	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n	at java.lang.reflect.Method.invoke(Method.java:498)\n	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:221)\n	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:136)\n	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:114)\n	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:827)\n	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:738)\n	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:85)\n	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:963)\n	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:897)\n	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:970)\n	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:872)\n	at javax.servlet.http.HttpServlet.service(HttpServlet.java:707)\n	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:846)\n	at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)\n	at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:838)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1550)\n	at com.restdude.web.filters.RestRequestNormalizerFilter.doFilterInternal(RestRequestNormalizerFilter.java:94)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.tuckey.web.filters.urlrewrite.RuleChain.handleRewrite(RuleChain.java:176)\n	at org.tuckey.web.filters.urlrewrite.RuleChain.doRules(RuleChain.java:145)\n	at org.tuckey.web.filters.urlrewrite.UrlRewriter.processRequest(UrlRewriter.java:92)\n	at org.tuckey.web.filters.urlrewrite.UrlRewriteFilter.doFilter(UrlRewriteFilter.java:394)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:197)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1529)\n	at org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:225)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:550)\n	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n	at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\n	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1589)\n	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1213)\n	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:487)\n	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1552)\n	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1126)\n	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n	at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\n	at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:118)\n	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)\n	at org.eclipse.jetty.server.Server.handle(Server.java:550)\n	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:321)\n	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:254)\n	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:269)\n	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:97)\n	at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:124)\n	at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:102)\n	at org.eclipse.jetty.util.thread.strategy.ExecutingExecutionStrategy.invoke(ExecutingExecutionStrategy.java:58)\n	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:201)\n	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:133)\n	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:672)\n	at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:590)\n	at java.lang.Thread.run(Thread.java:745)\n",
                        new SystemError.Builder().message("Invalid credentials").httpStatusCode(401).requestMethod("POST").requestUrl("/api/auth/userDetails").build()},
                {"9D3A69A716684719B3AE0027A30787F2", "2016-11-27 08:58:30.861", "InvalidCredentialsException: Not authenticated", "com.restdude.util.exception.http.InvalidCredentialsException: Not authenticated\n	at com.restdude.auth.userdetails.controller.UserDetailsController.remember(UserDetailsController.java:98)\n	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n	at java.lang.reflect.Method.invoke(Method.java:498)\n	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:221)\n	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:136)\n	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:114)\n	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:827)\n	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:738)\n	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:85)\n	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:963)\n	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:897)\n	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:970)\n	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:861)\n	at javax.servlet.http.HttpServlet.service(HttpServlet.java:687)\n	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:846)\n	at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)\n	at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:838)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1550)\n	at com.restdude.web.filters.RestRequestNormalizerFilter.doFilterInternal(RestRequestNormalizerFilter.java:92)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.tuckey.web.filters.urlrewrite.RuleChain.handleRewrite(RuleChain.java:176)\n	at org.tuckey.web.filters.urlrewrite.RuleChain.doRules(RuleChain.java:145)\n	at org.tuckey.web.filters.urlrewrite.UrlRewriter.processRequest(UrlRewriter.java:92)\n	at org.tuckey.web.filters.urlrewrite.UrlRewriteFilter.doFilter(UrlRewriteFilter.java:394)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:197)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1529)\n	at org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:225)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:550)\n	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n	at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\n	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1589)\n	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1213)\n	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:487)\n	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1552)\n	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1126)\n	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n	at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\n	at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:118)\n	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)\n	at org.eclipse.jetty.server.Server.handle(Server.java:550)\n	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:321)\n	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:254)\n	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:269)\n	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:97)\n	at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:124)\n	at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:102)\n	at org.eclipse.jetty.util.thread.strategy.ExecutingExecutionStrategy.invoke(ExecutingExecutionStrategy.java:58)\n	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:201)\n	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:133)\n	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:672)\n	at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:590)\n	at java.lang.Thread.run(Thread.java:745)\n",
                        new SystemError.Builder().message("Validation failed").httpStatusCode(400).requestMethod("POST").requestUrl("/api/auth/account").build()},
                {"3DB9455CDB853B1FAF3D70D693464979", "2016-11-27 08:58:31.948", "NotFoundException: Not Found", "com.restdude.util.exception.http.NotFoundException: Not Found\n	at com.restdude.domain.base.controller.AbstractPersistableModelController.findById(AbstractPersistableModelController.java:173)\n	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n	at java.lang.reflect.Method.invoke(Method.java:498)\n	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:221)\n	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:136)\n	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:114)\n	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:827)\n	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:738)\n	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:85)\n	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:963)\n	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:897)\n	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:970)\n	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:861)\n	at javax.servlet.http.HttpServlet.service(HttpServlet.java:687)\n	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:846)\n	at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)\n	at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:838)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1550)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:317)\n	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:127)\n	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:91)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:115)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:111)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:169)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.authentication.www.BasicAuthenticationFilter.doFilterInternal(BasicAuthenticationFilter.java:215)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:121)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:66)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:56)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:105)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:214)\n	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:177)\n	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:346)\n	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:262)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at com.restdude.web.filters.RestRequestNormalizerFilter.doFilterInternal(RestRequestNormalizerFilter.java:92)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.tuckey.web.filters.urlrewrite.RuleChain.handleRewrite(RuleChain.java:176)\n	at org.tuckey.web.filters.urlrewrite.RuleChain.doRules(RuleChain.java:145)\n	at org.tuckey.web.filters.urlrewrite.UrlRewriter.processRequest(UrlRewriter.java:92)\n	at org.tuckey.web.filters.urlrewrite.UrlRewriteFilter.doFilter(UrlRewriteFilter.java:394)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:197)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1529)\n	at org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:225)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:550)\n	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n	at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\n	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1589)\n	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1213)\n	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:487)\n	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1552)\n	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1126)\n	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n	at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\n	at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:118)\n	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)\n	at org.eclipse.jetty.server.Server.handle(Server.java:550)\n	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:321)\n	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:254)\n	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:269)\n	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:97)\n	at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:124)\n	at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:102)\n	at org.eclipse.jetty.util.thread.strategy.ExecutingExecutionStrategy.invoke(ExecutingExecutionStrategy.java:58)\n	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:201)\n	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:133)\n	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:672)\n	at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:590)\n	at java.lang.Thread.run(Thread.java:745)\n",
                        new SystemError.Builder().message("Not Found").httpStatusCode(404).requestMethod("GET").requestUrl("/api/rest/users/invalid").build()},
                {"BD4A0EB9D059D28E617EB6B0A56ED198", "2016-11-27 08:58:32.509", "NullPointerException: ", "java.lang.NullPointerException\n	at com.restdude.domain.friends.service.impl.FriendshipServiceImpl.saveSingle(FriendshipServiceImpl.java:147)\n	at com.restdude.domain.friends.service.impl.FriendshipServiceImpl.saveRelationship(FriendshipServiceImpl.java:125)\n	at com.restdude.domain.friends.service.impl.FriendshipServiceImpl.create(FriendshipServiceImpl.java:37)\n	at com.restdude.domain.friends.service.impl.FriendshipServiceImpl.create(FriendshipServiceImpl.java:23)\n	at sun.reflect.GeneratedMethodAccessor143.invoke(Unknown Source)\n	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n	at java.lang.reflect.Method.invoke(Method.java:498)\n	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:333)\n	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)\n	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)\n	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99)\n	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:281)\n	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96)\n	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)\n	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:213)\n	at com.sun.proxy.$Proxy242.create(Unknown Source)\n	at com.restdude.domain.base.controller.AbstractPersistableModelController.create(AbstractPersistableModelController.java:98)\n	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n	at java.lang.reflect.Method.invoke(Method.java:498)\n	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:221)\n	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:136)\n	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:114)\n	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:827)\n	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:738)\n	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:85)\n	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:963)\n	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:897)\n	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:970)\n	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:872)\n	at javax.servlet.http.HttpServlet.service(HttpServlet.java:707)\n	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:846)\n	at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)\n	at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:838)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1550)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:317)\n	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:127)\n	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:91)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:115)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:111)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:169)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.authentication.www.BasicAuthenticationFilter.doFilterInternal(BasicAuthenticationFilter.java:215)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:121)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:66)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:56)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:105)\n	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)\n	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:214)\n	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:177)\n	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:346)\n	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:262)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at com.restdude.web.filters.RestRequestNormalizerFilter.doFilterInternal(RestRequestNormalizerFilter.java:92)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.tuckey.web.filters.urlrewrite.RuleChain.handleRewrite(RuleChain.java:176)\n	at org.tuckey.web.filters.urlrewrite.RuleChain.doRules(RuleChain.java:145)\n	at org.tuckey.web.filters.urlrewrite.UrlRewriter.processRequest(UrlRewriter.java:92)\n	at org.tuckey.web.filters.urlrewrite.UrlRewriteFilter.doFilter(UrlRewriteFilter.java:394)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:197)\n	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1529)\n	at org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:225)\n	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1537)\n	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:550)\n	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n	at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\n	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1589)\n	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1213)\n	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:487)\n	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1552)\n	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1126)\n	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n	at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\n	at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:118)\n	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)\n	at org.eclipse.jetty.server.Server.handle(Server.java:550)\n	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:321)\n	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:254)\n	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:269)\n	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:97)\n	at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:124)\n	at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:102)\n	at org.eclipse.jetty.util.thread.strategy.ExecutingExecutionStrategy.invoke(ExecutingExecutionStrategy.java:58)\n	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:201)\n	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:133)\n	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:672)\n	at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:590)\n	at java.lang.Thread.run(Thread.java:745)\n",
                        new SystemError.Builder().message("Internal Server Error").httpStatusCode(500).requestMethod("POST").requestUrl("/api/rest/friendships").build()}};
        LocalDateTime now = LocalDateTime.now();
        for (int i = 0; i < stackTraces.length; i++) {
            if (usersIterator.hasNext()) {
                user = usersIterator.next();
            }
            Object[] stackTrace = stackTraces[i];
            ErrorLog st = this.stackTraceService.create(new ErrorLog(stackTrace[2].toString(), stackTrace[3].toString()));
            SystemError error = (SystemError) stackTrace[4];
            error.setErrorLog(st);
            error.setUser(user);
            LOGGER.debug("Error user: {}, new: {}", user, user.isNew());
            error = this.systemErrorService.create(error);
            errors.add(error);
        }
        return errors;
    }

}
